<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>library</title>
    <style>
        body {
            margin: 0;
            box-sizing: border-box;
            width: 100vw;
            height: 100vh;
            overflow: auto;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
<div class="out-box">
    <div class="container box"></div>
</div>
<script src="../dist/fmh-bc.js"></script>
<script>

	let {Root, Layer, Group, Rect, Circle, Line, Img, utils, Sprite, Input} = fmhBC.fmh;

	// let rect = new Rect()
	// r.add(l)
	// l.add(rect)
	//
	// rect.fill()
	// rect.start(() => {
	// 	rect.x = Math.sin(rect.clock.elapsedTime * 10) * 20 + 100
	//     rect.y = Math.cos(rect.clock.elapsedTime * 10) * 20 + 100
	// })
	// r.openAnimate()
	// let l2 = new Layer()
	// let g = new Group()
	// let list = []
	// let layerList = []
	//
	// function loadImage () {
	// 	return new Promise((resolve, reject) => {
	// 		let list = []
	// 		for (let i = 0; i < 8; i++) {
	// 			list.push(utils.loadImage(`./furr_walking_monster/gothit/skeleton-got_hit_${i}.png`))
	// 		}
	// 		Promise.all(list).then(res => {
	// 			let size = 50;
	// 			let result = res.map((img, index) => {
	// 				return {
	// 					image: img,
	// 					x: index * size,
	// 					y: 0,
	// 					width: size,
	// 					height: size,
	// 				}
	// 			})
	// 			resolve(result)
	// 		}).catch(err => {
	// 			reject(err)
	// 		})
	// 	})
	// }
	//
	// loadImage().then(res => {
	// 	res.forEach(item => {
	// 		let img = new Img(item)
	// 		l.add(img)
	// 		img.start(() => {
	// 			img.x++
	// 		})
	// 	})
	// 	l.isDrawLayer = false;
	// 	r.add(l)
	// })

	// console.log(utils.generateSpritePicture);
	let container = document.querySelector('.box')
	let r = new Root({domEl: container})
	let l = new Layer()
	let lists = []
	lists.name = 'gothit'
	for (let i = 0; i < 8; i++) {
		lists.push(`./furr_walking_monster/gothit/skeleton-got_hit_${i}.png`)
	}
	let lists2 = []
	lists2.name = 'attack'
	for (let i = 0; i < 25; i++) {
		lists2.push(`./furr_walking_monster/attack/skeleton-attack_${i}.png`)
	}
	let lists3 = []
	lists3.name = 'walking'
	for (let i = 0; i < 13; i++) {
		lists3.push(`./furr_walking_monster/walking/skeleton-walking_${i}.png`)
	}
	let sprite = [
		lists,
		lists2,
		lists3,
	]
	let bugList = [];
	bugList.name = 'bug';
	for (let i = 0; i < 15; i++) {
		bugList.push(`./png/skeleton-animation_${i < 10 ? '0' + i : i}.png`)
	}

	let input = new Input('all')
	console.log(bugList)
	let bug = new Sprite([bugList], input)
	console.log(bug);
	let sp = new Sprite(sprite, input)
	bug.subscribe('ready', (ins) => {
		ins.changeSpeed('bug', 1000)
		let speed = 10
		ins.start(() => {
			if (ins.input.directive === 'u') {
				ins.y -= speed
				resetPosition(ins)
			} else if (ins.input.directive === 'r') {
				ins.x += speed
				resetPosition(ins)
			} else if (ins.input.directive === 'd') {
				ins.y += speed
				resetPosition(ins)
			} else if (ins.input.directive === 'l') {
				ins.x -= speed
				resetPosition(ins)
			} else if (['ur', 'ru'].includes(ins.input.directive)) {
				ins.x += speed
				ins.y -= speed
				resetPosition(ins)
			} else if (['ul', 'lu'].includes(ins.input.directive)) {
				ins.x -= speed
				ins.y -= speed
				resetPosition(ins)
			} else if (['dr', 'rd'].includes(ins.input.directive)) {
				ins.x += speed
				ins.y += speed
				resetPosition(ins)
			} else if (['dl', 'ld'].includes(ins.input.directive)) {
				ins.x -= speed
				ins.y += speed
				resetPosition(ins)
			}
			if (ins.input.otherKeyCode[0] === 65) {
				if (Math.floor(ins.clock.elapsedTime) % 1 === 0) {
					let bullet = new Rect({
						x: ins.x,
						y: ins.y,
						width: 2,
						height: 2,
					})

					l.add(bullet)
					bullet.start(() => {
						bullet.x += 20
						if (bullet.x >= bullet.cvWidth) {
							l.removeChild(bullet)
						}
						console.log(l.children)
					})
				}
			}
		})
	})

	l.add(bug)
	r.add(l)

	r.openAnimate()

	function resetPosition (ins) {
		let {minX, minY, maxX, maxY} = ins.getSize()
		if (ins.x <= minX) {
			ins.x = minX
		} else if (ins.x >= maxX) {
			ins.x = maxX
		} else if (ins.y <= minY) {
			ins.y = minY
		} else if (ins.y >= maxY) {
			ins.y = maxY
		}
	}

	// let cv = utils.createEl('canvas', {cvWidth: 600, cvHeight: 450, position: 'relative'})
	// document.body.appendChild(cv)
	// let ctx = cv.getContext('2d')
	// let img = new Image()
	// img.src = './bg.png'
	// var dx = 0;
	// var dy = 0;
	// var dWidth
	// var dHeight
	//
	// let iw;
	// let ih;
	// let size = 200;
	// let wp = iw / size;
	// let hp = ih / size;
	//
	// img.onload = () => {
	// 	iw = img.naturalWidth;
	// 	ih = img.naturalHeight;
	// 	wp = iw / size;
	// 	hp = ih / size;
	// 	dWidth = iw / wp;
	// 	whp = iw / ih;
	// 	dHeight = dWidth / whp
	//
	// 	drawIt()
	//
	// }


</script>
</body>
</html>
